# =============================================================================
# Cross-Team Communication Protocol
# =============================================================================
#
# Rules governing how teams interact. The /comms skill enforces these.
# These rules are UNIVERSAL — they apply to every project using this workflow.
#
# =============================================================================

# -----------------------------------------------------------------------------
# Core Principle
# -----------------------------------------------------------------------------
# Messages cross team boundaries. Issues stay local.
# Each team owns its own issue queue. Other teams request work via messages.

principles:
  - Messages cross team boundaries, issues stay local
  - Each team triages its own inbound messages and creates its own issues
  - No team creates issues in another team's queue
  - The human supervisor can create issues anywhere

# -----------------------------------------------------------------------------
# Issue Ownership
# -----------------------------------------------------------------------------

issues:
  # Who can create issues in a team's queue
  creation:
    allowed_creators:
      - self     # The team itself
      - human    # The human supervisor
    blocked_creators:
      - other_teams  # Must send a message instead

  # Issue lifecycle — the owning team controls this
  lifecycle:
    - queue      # Created, not started
    - active     # In progress
    - completed  # Done

  # Naming convention
  naming: "{TEAM_PREFIX}-ISS-{NNN}_{brief_description}.md"

# -----------------------------------------------------------------------------
# Messaging
# -----------------------------------------------------------------------------

messaging:
  # Directory pattern for message channels
  # For N active teams, channels are: messaging/{sender}-to-{recipient}/
  channel_pattern: "messaging/{sender_alias}-to-{recipient_alias}/"
  archive_dir: "messaging/archive/"
  template_dir: "messaging/templates/"

  # When to send a message vs. create an issue
  use_message_for:
    - Bug reports about another team's code
    - Requests for new endpoints or features from another team
    - Status updates that affect another team
    - Responses to received messages
    - Contract proposals (endpoint shapes, data formats)

  use_issue_for:
    - Work items for YOUR OWN team only
    - Triaged inbound messages converted to local work

  # Message naming convention
  naming: "YYYY-MM-DD_{subject_slug}.md"

# -----------------------------------------------------------------------------
# Cross-Team Bug Reports
# -----------------------------------------------------------------------------

bugs:
  # When you find a bug in another team's code:
  action: send_message
  steps:
    - Describe the bug with evidence (endpoint, expected vs actual)
    - Include reproduction steps
    - Set priority based on impact
    - Send to the responsible team's inbox
    - Do NOT fix the bug directly in their codebase
    - Do NOT create an issue in their queue

# -----------------------------------------------------------------------------
# Cross-Team Feature Requests
# -----------------------------------------------------------------------------

requests:
  action: send_message
  steps:
    - Define the contract (method, path, request/response shapes)
    - Include priority and what it blocks on your side
    - Send to the responsible team's inbox
    - Wait for their response before building dependent features
    - Use placeholder/mock data while waiting

# -----------------------------------------------------------------------------
# Inbound Message Triage
# -----------------------------------------------------------------------------

triage:
  # When you receive a message from another team:
  steps:
    - Read and assess the message
    - "If bug report: verify it's your team's responsibility"
    - "If request: evaluate feasibility and priority"
    - "If accepted: create a LOCAL issue in your own queue"
    - "If rejected: respond to sender with explanation"
    - "If response: update related issue/thread"
  # The decision to create an issue is ALWAYS the receiving team's
